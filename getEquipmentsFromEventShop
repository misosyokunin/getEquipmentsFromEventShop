javascript:(async() => {"use strict";/*┏━━━━━━━━━━━━━━━━━┓┃ＭＳＯ＿イベントショップの装備取得┃┗━━━━━━━━━━━━━━━━━┛Developer:魚頭男（https://minesweeper.online/ja/player/16842796 ）Writing:魚頭男（https://minesweeper.online/ja/player/16842796 ）イベントショップの装備のデータを取得するのは面倒。というわけで、クローラーを作りました。=======================================================このツールはMinesweeper.Online様（https://minesweeper.online/ 、以下「ＭＳＯ」）より公認を受けていない、非公認のものです。当プログラムは、ＭＳＯ様とは一切関係ございませんので、このプログラムに関する質問・提言等の連絡は魚頭男（https://minesweeper.online/ja/player/16842796 、以下「魚」）までお願いします。当プログラムについて、ＭＳＯ様に連絡することは絶対にしないでください。運営者様並びにユーザー様にご迷惑にならないように努めておりますが、万が一のことがありましたら即削除いたします。=======================================================*//*＝＝＝＝＝＝＝＝＝【使い方】＝＝＝＝＝＝＝＝＝このスクリプトを実行して身を任せるだけです。1つの装備辺り2秒ペースで取得します。全体でだいたい130秒掛かります（65個の装備=13ステータス*5品目）。なお、中断機能を設けておりますので、無謀な実行でも大丈夫です。スクリプト実行中は、できるだけタブの遷移やブラウザをバックグラウンドにしないようにしてください。なお、他言語でも同じようなことができると思います。ただ、このスクリプトのままでは動きませんので、適宜変えてください（「ja」や抽出文言）。*//*■初期チェック*/const TAR_URL = "https://minesweeper.online/ja/events";const TAR_TITLE = "イベントページ";if(!location.href.includes(TAR_URL)){const result = window.confirm(`${TAR_TITLE}ではありません。\n${TAR_TITLE}へ飛びますか？\n（ページ遷移後に再度このスクリプトを実行してください。）`);if(result){location.href = TAR_URL;}else{alert(`${TAR_TITLE}（${TAR_URL}）を表示させてください。`);}return;}if(!document.getElementById("event_shop_table")){alert("イベントショップがありません。");return;}/*■初期処理*/let isLooping = true;const MAX = document.querySelectorAll("#event_shop_table > tbody > tr").length;const EQUIPMENT_START_ARGU = 5;/*取得する装備の最初の場所*/const EQUIPMENT_KIND_NUMBER = 5;/*装備の種類の数*/const bk = document.createElement("div");bk.style = "position:fixed; top: 0px; left: 0px; background-color: rgba(0, 0, 0, 0.5); width: 100vw; height: 100vh; font-size: 2em; z-index: 100; display: flex; justify-content: center; align-items: center; flex-direction: column;";bk.innerText = "イベントショップデータ取得中…\nしばらくお待ちください…";const breakButton = document.createElement("button");breakButton.type = "button";breakButton.textContent = "終了する";breakButton.addEventListener("click", () => {isLooping = false;});bk.append(breakButton);const progress = document.createElement("progress");progress.max = (MAX - EQUIPMENT_START_ARGU) * EQUIPMENT_KIND_NUMBER;progress.value = 0;bk.append(progress);{const label = document.createElement("label");label.style = "cursor: pointer;";bk.append(label);const chkShowHeader = document.createElement("input");chkShowHeader.type = "checkbox";chkShowHeader.checked = true;chkShowHeader.id = "_chkCopyDataWhenJumpToSheet";chkShowHeader.style = "transform: scale(1.5); margin: 5px;";label.append(chkShowHeader);const span = document.createElement("span");span.textContent = "シート遷移時にデータをコピーする";span.style = "font-size: 16px";label.append(span);}{const label = document.createElement("label");label.style = "cursor: pointer;";bk.append(label);const chkShowHeader = document.createElement("input");chkShowHeader.type = "checkbox";chkShowHeader.checked = true;chkShowHeader.id = "_chkDataFormatForOmoya";chkShowHeader.style = "transform: scale(1.5); margin: 5px;";label.append(chkShowHeader);const span = document.createElement("span");span.textContent = "母屋用のデータ形式にする";span.style = "font-size: 16px";label.append(span);}document.body.append(bk);/*■データ取得*/const putDatas = [];const omoyaDatas = [];const ZYUNBAN = {"E": 0,"H": 1,"T": 2,"R": 3,"S": 4};for(let i = EQUIPMENT_START_ARGU; i < MAX; i++){for(let j = 0; j < EQUIPMENT_KIND_NUMBER; j++){const tr = document.querySelectorAll("#event_shop_table > tbody > tr")[i];const td = tr.querySelector(":scope > td:nth-of-type(2)");const temp = [];const omoya_temp = [];const anc = tr.querySelector(":scope > td:nth-of-type(1) a");const title = td.querySelector("div:nth-of-type(1)");temp.push(title.textContent);const stat = td.querySelector("td:last-of-type");temp.push(stat.textContent);const td2 = td.querySelector("div:nth-of-type(2)");const datas = td2.querySelectorAll("div");datas.forEach((data) => {temp.push(data.textContent);});const kata = title.textContent.replace(/^.*?\s/, "").replace(/\s/g, "");omoya_temp.push(`=HYPERLINK("${anc}","${kata}")`);const zyunban = ZYUNBAN[kata[1]] + i * 5;putDatas[zyunban] = temp;omoyaDatas[zyunban] = omoya_temp;progress.value = Number(progress.value) + 1;if(isLooping){tr.querySelector("button:last-child").click();await new Promise(resolve => setTimeout(resolve, 2000));/*★1000未満にしちゃダメ！！！*/}else{i = MAX;j = EQUIPMENT_KIND_NUMBER;}}}/*名誉ポイントダイヤモンド初級チケットパック中級チケットパック上級チケットパック 40% 45% 50% 55% 60% 65% 70% 75% 80% 85% 90% 95% 100%*//*■データ整形*//*■データ表示＆コピー*/const isCopyDataWhenJumpToSheet = document.getElementById("_chkCopyDataWhenJumpToSheet").checked;const isDataFormatForOmoya = document.getElementById("_chkDataFormatForOmoya").checked;bk.innerHTML = "";const textarea = document.createElement("textarea");if(isDataFormatForOmoya){omoyaDatas.forEach((data) => {const str = data.join("\t") + "\n";textarea.value += str;});}else{putDatas.forEach((data) => {const str = data.join("\t") + "\n";textarea.value += str;});}textarea.style = "font-size: 16px; width: 90%; height: 50%; white-space: pre;";bk.append(textarea);const wrapper = document.createElement("div");wrapper.style = "height: 20%; width: 90%; font-size: 16px; display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); gap: 0px;";bk.append(wrapper);const copyButton = document.createElement("button");copyButton.type = "button";copyButton.textContent = "📃コピーする";copyButton.addEventListener("click", () => {textarea.select();document.execCommand("copy");window.getSelection?.().removeAllRanges();textarea.blur();copyButton.textContent = "📃コピーしました！";setTimeout(() => {copyButton.textContent = "📃コピーする";}, 3000);});copyButton.style = "grid-column: span 2 / span 2;";wrapper.append(copyButton);const closeButton = document.createElement("button");closeButton.type = "button";closeButton.textContent = "閉じる";closeButton.addEventListener("click", () => {bk.remove();});closeButton.style = "grid-column-start: 1; grid-row-start: 2;";wrapper.append(closeButton);const jumpButton = document.createElement("button");jumpButton.type = "button";jumpButton.style = "grid-column-start: 2; grid-row-start: 2;";wrapper.append(jumpButton);const anc = document.createElement("a");anc.innerText = "コピペしにいく\n（スプレッドシートへ飛びます）";anc.href = "https://docs.google.com/spreadsheets/d/16hVIsSFAaGIHYa6hVY-paaX5__zv8ZE7JH_49NkqVIY/edit?gid=38415716#gid=38415716";anc.setAttribute("target", '_blank');if(isCopyDataWhenJumpToSheet){anc.addEventListener("click", () => {textarea.select();document.execCommand("copy");window.getSelection?.().removeAllRanges();textarea.blur();});}anc.style = "display: block;";jumpButton.append(anc);})();
